<tr id="stream_<%= stream.id %>" class="hover:bg-gray-50">
  <!-- Streamer (read-only) -->
  <td class="<%= stream_column_class("streamer", "px-3 py-4 whitespace-nowrap text-sm", @hidden_columns) %>"
      data-column="streamer"
      data-stream-table-preferences-target="column">
    <div class="flex items-start gap-3">
      <% streamer_platforms = stream.streamer&.platforms || [] %>
      <div>
        <div id="stream_<%= stream.id %>_streamer_name" class="text-sm font-medium text-gray-900">
          <%= stream.streamer&.name || 'Unknown' %>
        </div>
        <div id="stream_<%= stream.id %>_streamer_platform" class="text-sm text-gray-500">
          <%= streamer_platforms.any? ? streamer_platforms.join(", ") : "N/A" %>
        </div>
      </div>
      <details class="mt-1 group">
        <summary class="cursor-pointer select-none text-gray-400 hover:text-gray-600 group-open:text-gray-700 list-none [&::-webkit-details-marker]:hidden [&::marker]:content-['']" title="Reassign streamer">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7h5m0 0v5m0-5l-6 6M8 17H3m0 0v-5m0 5l6-6" />
          </svg>
          <span class="sr-only">Reassign streamer</span>
        </summary>
        <div class="mt-2">
          <%= form_with model: [:admin, stream], class: "flex items-center gap-2" do |form| %>
            <%= hidden_field_tag :context, "spreadsheet" %>
            <%= form.select :streamer_id,
                options_for_select(streamer_options, stream.streamer_id),
                { include_blank: "Unassigned" },
                class: "text-xs rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",
                id: "stream_#{stream.id}_streamer_select" %>
            <%= form.submit "Save", class: "px-2 py-1 text-xs rounded-md bg-indigo-600 text-white hover:bg-indigo-700" %>
          <% end %>
        </div>
      </details>
    </div>
  </td>

  <!-- Title -->
  <td class="<%= stream_column_class("title", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="title"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_title"
         data-stream-id="<%= stream.id %>"
         data-field="title"
         data-original-value="<%= stream.title %>"
         class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <%= stream.title || '-' %>
    </div>
  </td>

  <!-- Source -->
  <td class="<%= stream_column_class("source", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="source"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_source"
         data-stream-id="<%= stream.id %>"
         data-field="source"
         data-original-value="<%= stream.source %>"
         class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <%= stream.source %>
    </div>
  </td>

  <!-- Link -->
  <td class="<%= stream_column_class("link", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="link"
      data-stream-table-preferences-target="column">
    <div class="flex items-center gap-2">
      <div data-collaborative-spreadsheet-target="cell"
           data-cell-id="stream_<%= stream.id %>_link"
           data-stream-id="<%= stream.id %>"
           data-field="link"
           data-original-value="<%= stream.link %>"
           class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors max-w-xs truncate min-h-[1.5rem] flex-1 min-w-0">
        <%= stream.link %>
      </div>
      <% if stream.link.present? %>
        <%= link_to stream.link,
            target: "_blank",
            rel: "noopener",
            class: "text-gray-400 hover:text-gray-600",
            title: "Open in new tab" do %>
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
          <span class="sr-only">Open in new tab</span>
        <% end %>
      <% end %>
    </div>
  </td>

  <!-- Platform -->
  <td class="<%= stream_column_class("platform", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="platform"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_platform"
         data-stream-id="<%= stream.id %>"
         data-field="platform"
         data-field-type="select"
         data-original-value="<%= stream.platform %>"
         data-select-options='<%= Stream.platforms.to_json %>'
         class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <%= stream.platform || '-' %>
    </div>
  </td>

  <!-- Status -->
  <td class="<%= stream_column_class("status", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="status"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_status"
         data-stream-id="<%= stream.id %>"
         data-field="status"
         data-field-type="select"
         data-original-value="<%= stream.status %>"
         data-select-options='<%= Stream.statuses.to_json %>'
         class="text-sm cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
        <%= stream.status == 'Live' ? 'bg-green-100 text-green-800' :
            stream.status == 'Offline' ? 'bg-red-100 text-red-800' :
            'bg-gray-100 text-gray-800' %>">
        <%= stream.status %>
      </span>
    </div>
  </td>

  <!-- City -->
  <td class="<%= stream_column_class("city", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="city"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_city"
         data-stream-id="<%= stream.id %>"
         data-field="city"
         data-original-value="<%= stream.city %>"
         class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <%= stream.city || '-' %>
    </div>
  </td>

  <!-- State -->
  <td class="<%= stream_column_class("state", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="state"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_state"
         data-stream-id="<%= stream.id %>"
         data-field="state"
         data-original-value="<%= stream.state %>"
         class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <%= stream.state || '-' %>
    </div>
  </td>

  <!-- Kind -->
  <td class="<%= stream_column_class("kind", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="kind"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_kind"
         data-stream-id="<%= stream.id %>"
         data-field="kind"
         data-field-type="select"
         data-original-value="<%= stream.kind %>"
         data-select-options='<%= { video: "video", web: "web", overlay: "overlay", background: "background" }.to_json %>'
         class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <%= stream.kind || 'video' %>
    </div>
  </td>

  <!-- Orientation -->
  <td class="<%= stream_column_class("orientation", "px-3 py-4 whitespace-nowrap relative", @hidden_columns) %>"
      data-column="orientation"
      data-stream-table-preferences-target="column">
    <div data-collaborative-spreadsheet-target="cell"
         data-cell-id="stream_<%= stream.id %>_orientation"
         data-stream-id="<%= stream.id %>"
         data-field="orientation"
         data-field-type="select"
         data-original-value="<%= stream.orientation %>"
         data-select-options='<%= Stream.orientations.to_json %>'
         class="text-sm text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded transition-colors min-h-[1.5rem]">
      <%= stream.orientation || '-' %>
    </div>
  </td>

  <!-- Started At (non-editable) -->
  <td class="<%= stream_column_class("started_at", "px-3 py-4 whitespace-nowrap", @hidden_columns) %>"
      data-column="started_at"
      data-stream-table-preferences-target="column">
    <div class="text-sm text-gray-500 px-2 py-1">
      <%= stream.started_at&.strftime('%b %d, %Y %I:%M %p') || '-' %>
    </div>
  </td>

  <!-- Last Checked (non-editable) -->
  <td class="<%= stream_column_class("last_checked_at", "px-3 py-4 whitespace-nowrap", @hidden_columns) %>"
      data-column="last_checked_at"
      data-stream-table-preferences-target="column">
    <div id="stream_<%= stream.id %>_last_checked_at" class="text-sm text-gray-500 px-2 py-1">
      <%= time_ago_in_words_with_nil(stream.last_checked_at) %>
    </div>
  </td>

  <!-- Last Live (non-editable) -->
  <td class="<%= stream_column_class("last_live_at", "px-3 py-4 whitespace-nowrap", @hidden_columns) %>"
      data-column="last_live_at"
      data-stream-table-preferences-target="column">
    <div id="stream_<%= stream.id %>_last_live_at" class="text-sm text-gray-500 px-2 py-1">
      <%= time_ago_in_words_with_nil(stream.last_live_at) %>
    </div>
  </td>

  <!-- Actions -->
  <td class="<%= stream_column_class("actions", "px-3 py-4 whitespace-nowrap text-right text-sm font-medium", @hidden_columns) %>"
      data-column="actions"
      data-stream-table-preferences-target="column">
    <div class="flex items-center space-x-2">
      <% if stream.link.present? %>
        <%= link_to stream.link, target: '_blank', rel: 'noopener',
            class: 'text-gray-400 hover:text-gray-500',
            title: 'View Stream' do %>
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
        <% end %>
      <% end %>

      <%= button_to admin_toggle_pin_stream_path(stream),
          method: :patch,
          params: { context: "spreadsheet" },
          class: 'text-gray-400 hover:text-gray-500',
          title: stream.is_pinned ? 'Unpin' : 'Pin' do %>
        <svg class="h-5 w-5 <%= 'text-yellow-500' if stream.is_pinned %>"
             fill="<%= stream.is_pinned ? 'currentColor' : 'none' %>"
             stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
        </svg>
      <% end %>

      <%= button_to admin_stream_path(stream),
          method: :delete,
          data: {
            turbo_confirm: 'Are you sure you want to delete this stream?',
            turbo_method: :delete
          },
          class: 'text-gray-400 hover:text-red-600',
          title: 'Delete' do %>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      <% end %>
    </div>
  </td>
</tr>
